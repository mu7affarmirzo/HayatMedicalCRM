{% load static %}

<div class="row mb-3">
    <div class="col-md-12">
        <a href="{% url 'sanatorium.doctors:procedure_create' history.id %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Добавить лечебную процедуру
        </a>
    </div>
</div>

{% if procedures %}
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead>
            <tr>
                <th>№</th>
                <th>Название</th>
                <th>Терапевт</th>
                <th>Начало</th>
                <th>Частота</th>
                <th>Прогресс</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
            </thead>
            <tbody>
            {% for procedure in procedures %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ procedure.medical_service.name }}</td>
                    <td>{{ procedure.therapist.full_name|default:"Не назначен" }}</td>
                    <td>{{ procedure.start_date|date:"d.m.Y" }}</td>
                    <td>{{ procedure.frequency }}</td>
                    <td>
                        <div class="position-relative" style="height: 24px;">
                            <div class="progress" style="height: 24px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                                     role="progressbar"
                                     style="width: {{ procedure.progres_percentile }}%"
                                     aria-valuenow="{{ procedure.proceeded_sessions }}"
                                     aria-valuemin="0"
                                     aria-valuemax="{{ procedure.quantity }}">
                                </div>
                            </div>
                            <div class="position-absolute d-flex justify-content-center align-items-center"
                                 style="top: 0; left: 0; right: 0; bottom: 0; font-weight: bold;">
                                <span>{{ procedure.proceeded_sessions }}/{{ procedure.quantity }}</span>
                            </div>
                        </div>
                    </td>
                    <td>
                    <span class="badge status-{{ procedure.state }}">
                        {{ procedure.get_state_display }}
                    </span>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="{% url 'sanatorium.doctors:procedure_detail' procedure.id %}" class="btn btn-info" title="Просмотр">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{% url 'sanatorium.doctors:procedure_edit' procedure.id %}" class="btn btn-warning"
                               title="Редактировать">
                                <i class="fas fa-edit"></i>
                            </a>

                            <a href="{% url 'sanatorium.doctors:procedure_delete' procedure.id %}" class="btn btn-danger" title="Удалить">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

{% else %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle mr-2"></i>
        Нет назначенных лечебных процедур
    </div>
{% endif %}